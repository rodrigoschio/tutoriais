<!doctype html>
<html lang="pt-br">
<head>
	<title>Tutorial Banco de Dados</title>
	<meta name="description" content="Como iniciar com php e mysql. Comandos básicos de php. Criando uma base de dados mysql com xampp." />
	<link rel="canonical" href="https://rodrigoschio.github.io/tutoriais/modulos/3/index.htm" />
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width" />
	<link rel="icon" href="../../imagens/favicon.ico" />
	<link href="../../css/styles.css" rel="stylesheet" />
	<link href="../../css/prism.css" rel="stylesheet" />
</head>

<body>
	<h1><a href="../../index.htm"><span>Tutoriais</span></a></h1>
	<main>

<article>
<h2>Tutorial Banco de Dados</h2>
O intuito desse tutorial é apresentar o php e mysql que são softwares baseados em código digitado.<br>
Para seguir esse tutorial são necessárias muitas ações além de escrever código, mas o <b>principal</b> é o ato de codar.<br><br>
<li><b>C</b> - Create (armazenar no banco de dados)</li>
<li><b>R</b> - Read (acessar registros na base de dados)</li>
<li><b>U</b> - Update (alterar registro)</li>
<li><b>D</b> - Delete (excluir registro)</li><br>
<b>php</b> - Linguagem de programação de servidores<br><br>
<b>sql</b> - Linguagem de bancos de dados
</article>

<article>
<h2>Instalar o Xampp</h2>
O Xampp é um software que emula um webserver.<br>
Ele instala o php e o mysql.<br><br>
<img class=imagem src=imagens/2.png onclick="window.open(this.src,'_blank');">
</article>

<article>
<h2>Criar um arquivo html</h2>
Crie um arquivo chamado index.htm<br>
É importante entender que esse tipo de arquivo contém um tipo de código que é ao mesmo tempo entendível por seres humanos e renderizável pelos computadores.<br><br>
Escreva "hello world" nesse arquivo.<br>
Salve e 'execute pelo browser'.<br><br>
Perceba que são duas maneiras diferentes de lidar com o mesmo arquivo.
</article>

<article>
<h2>Xampp emula websever</h2>
Um webserver tradicional é um computador como outro qualquer, só que ele fica conectado a internet 24hs por dia.<br>
Quando outro computador acessa o webserver ele envia arquivos.<br>
Basicamente ele fica ligado o tempo todo esperando uma 'requisição'.<br>
Quando ocorre uma requisição ele envia uma resposta.<br><br>
<img class=imagem src=imagens/3.png onclick="window.open(this.src,'_blank');"><br><br>
O Xampp emula um webserver.<br>
No painel de controle do Xampp é possível startar o apache.<br>
O apache é o php.<br>
Ele serve para que o programador escreva instruções para o server executar quando ele receber a requisição.<br><br>
Exemplo: Quando o user envia uma requisição para o server, ele pode armazenar algo no banco de dados.<br><br>
O mysql também fica apenas experando para ser acionado.<br>
A diferença é que quem acessa o mysql é o proprio php.<br><br>
O php recebe a requisição, depois ele busca a informação no banco de dados e depois ele devolve a resposta para o usuário.
</article>

<article>
<h2>php / htdocs / localhost</h2>
É preciso que os arquivos estejam dentro da pasta xampp/htdocs/<br><br>
Quando o apache recebe a requisição ele procura na pasta xampp/htdocs/ qual arquivo php deve ser executado.<br><br>
Para começar vamos criar um arquivo chamado 'index.php' na pasta xampp\htdocs\produtos<br><br>
O conteúdo desse arquivo:
<pre><code class="language-php">&lt;!doctype html>
&lt;html>
&lt;body>

codigo html&lt;br>

&lt;?php
echo "codigo php&lt;br>";
?>

&lt;/body>
&lt;/html></code></pre>
Para acessar pelo browser basta digitar localhost/produtos<br>
(é preciso que o php esteja startado no xampp)<br><br>
<img class=imagem src=imagens/4.png onclick="window.open(this.src,'_blank');">
</article>

<article>
<h2>Tela de Cadastro</h2>
Para começar a fazer o cadastro do produto podemos utilizar o seguinte código:
<pre><code class="language-html">&lt;!doctype html>
&lt;html>

&lt;head>
&lt;style>
body{
	margin:0px;
	background-color:#e1e1e1;
	font-family:'Segoe Ui';
}

footer{
	position:fixed;
	display:block;
	width:100vw;
	bottom:0px;
	background-color:#8899bb;
	color:#333333;
	padding:20px;
}

h1{
	background-color:#8899bb;
	color:#333333;
	padding:20px;
	margin-top:0px;
}

table{
	background-color:#ffffff;
	padding:8px;
	margin:0px auto;
}

textarea{
	width:240px;
	height:66px;
}

th{
	background-color:#88bb99;
	color:#333333;
	padding:10px;
}

.aviso{
	background-color:#aa0000;
	color:#ffffff;
	font-weight:bold;
	padding:16px;
	text-align:center;
}

#preco{
	width:60px;
}
&lt;/style>
&lt;/head>

&lt;body>
&lt;h1>Tutorial CRUD&lt;/h1>

&lt;form action=index.php method=post enctype=multipart/form-data>
&lt;table>
	&lt;tr>
		&lt;th colspan=2>Cadastro de Produto&lt;/th>
	&lt;/tr>

	&lt;tr>
		&lt;td>Nome&lt;/td>
		&lt;td>&lt;input name=nome>&lt;/td>
	&lt;/tr>
	&lt;tr>
		&lt;td>Descrição&lt;/td>
		&lt;td>&lt;textarea name=descricao>&lt;/textarea>&lt;/td>
	&lt;/tr>
	&lt;tr>
		&lt;td>Imagem&lt;/td>
		&lt;td>&lt;input name=arq type=file>&lt;/td>
	&lt;/tr>
	&lt;tr>
		&lt;td>Preço&lt;/td>
		&lt;td>&lt;input name=preco id=preco>&lt;/td>
	&lt;/tr>

	&lt;tr>
		&lt;td colspan=2 align=right>
			&lt;button>Salvar&lt;/button>
		&lt;/td>
	&lt;/tr>
&lt;/table>
&lt;/form>

&lt;footer>&lt;/footer>

&lt;/body>
&lt;/html></code></pre>
<img class=imagem src=imagens/5.png onclick="window.open(this.src,'_blank');">
</article>

<article>
<h2>Create table</h2>
Vamos começar a lidar com a base de dados.<br>
Para isso vamos usar o phpMyAdmin que vem instalado no Xampp.<br><br>
<img class=imagem src=imagens/8.png onclick="window.open(this.src,'_blank');"><br><br>
<img class=imagem src=imagens/9.png onclick="window.open(this.src,'_blank');"><br><br>
É preciso criar uma nova base de dados.<br>
Podemos dar o nome <b>tutorial</b>.<br><br>
É preciso criar uma tabela chamada <b>produtos</b>.<br>
Com os campos:<br>
<li>id (int auto_increment)</li>
<li>nome (varchar)</li>
<li>descricao (varchar)</li>
<li>imagem (varchar)</li>
<li>preco (varchar)</li><br>
É importante que o campo id seja <b>auto_increment</b>
</article>

<article>
<h2>Comando insert</h2>
Vamos fazer com que a tela de cadastro envie os dados para o DB.
<pre><code class="language-php">&lt;body>
&lt;h1>Tutorial CRUD&lt;/h1>

&lt;?php
$conn = new PDO('mysql:host=localhost;dbname=tutorial', 'root', ''); //conexão com a base de dados

if(isset($_POST['nome'])) { //quando o user preenche o campo nome da página e clica em salvar, o browser envia nova request para o server. nessa nova request existe uma varável do tipo POST

	$conn -> query("insert into produtos(nome, descricao, preco) values('".$_POST['nome']."', '".$_POST['descricao']."', '".$_POST['preco']."')"); //nessa linha o php envia um comando para inserir na base de dados

	if(isset($_FILES['arq']) && ($_FILES['arq']['tmp_name']) != '') { //se o user fez o upload da imagem do produto
		@mkdir("imagens"); //cria a pasta imagens dentro de xampp\htdocs\produtos

		$inserido = $conn -> lastInsertId(); //esse comando armazena o id do produto que foi inserido na base de dados

		move_uploaded_file($_FILES['arq']['tmp_name'], "imagens/" . $inserido . "_" . $_FILES['arq']['name']); //esse comando move o arquivo uppado (do endereço temporário para a pasta xampp\htdocs\produtos

		$conn -> query("update produtos set imagem='" . $inserido . "_".$_FILES['arq']['name']."' where id=" . $inserido); //esse comando coloca o nome da imagem uppada na base de dados
	}
	echo "&lt;div class=aviso>produto inserido na base de dados&lt;/div>&lt;br>\n";
}
?>

&lt;form action=index.php method=post enctype=multipart/form-data>
&lt;table></code></pre>
</article>

<article>
<h2>Lista de Produtos</h2>
Abaixo do formulário podemos exibir a lista de produtos cadastrados.
<pre><code class="language-php">&lt;/table>
&lt;/form>

&lt;?php

$stmt = $conn -> query("select id,nome from produtos"); //envia a query para a base de dados

if($stmt -> rowCount()) { //se existe algum produto cadastrado
	echo "&lt;br>&lt;br>\n";
	echo "&lt;table>\n";

	while($row = $stmt -> fetch()) { //o db vai armazenando na variável $row o valor de cada registro
		echo "&lt;tr>"; //uma linha da tabela de produtos

		echo "&lt;td>" . $row['id'] . "&lt;/td>";
		echo "&lt;td>" . $row['nome'] . "&lt;/td>"; //o nome do produto

		echo "&lt;td>&lt;button onclick=\"location.href='index.php?id=" . $row['id'] . "';\">Editar&lt;/button>&lt;/td>"; //botão para editar produto
		echo "&lt;td>&lt;button onclick=\"if(confirm('Tem Certeza ?'))location.href='index.php?del=" . $row['id'] . "';\">Excluir&lt;/button>&lt;/td>"; //botão para deletar

		echo "&lt;/tr>";
	}

	echo "&lt;/table>\n";
}

?>

&lt;footer>&lt;/footer></code></pre>
<img class=imagem src=imagens/screenshot.png onclick="window.open(this.src,'_blank');">
</article>

<article>
<h2>Comando delete</h2>
<pre><code class="language-php">&lt;h1>Tutorial CRUD&lt;/h1>

&lt;?php
$conn = new PDO('mysql:host=localhost;dbname=tutorial', 'root', ''); //conexão com a base de dados

if(isset($_GET['del'])) { //se na url está index.php?del=7 exclui o produto 7

	$conn -> query("delete from produtos where id=" . $_GET['del']); //envia o comando de deletar para a base de dados

	echo "&lt;div class=aviso>produto excluído da base de dados&lt;/div>&lt;br>\n"; //exibe mensagem de confirmação
}

?></code></pre>
</article>

<article>
<h2>Update</h2>
Para implementar a alteração é preciso reescrever o formulário de cadastro para que ele busque os dados.
<pre><code class="language-php">if(isset($_POST['nome'])) { //se a página formulário postou algo para o db

	if(isset($_GET['id'])) { //se na url está definido um id então os dados do produto devem ser ALTERADOS no db

		$conn -> query("update produtos set nome='" . $_POST['nome'] . "', descricao='" . $_POST['descricao'] . "', preco='" . $_POST['preco'] . "' where id=" . $_GET['id']); //essa linha envia para o db o comando de update

		if(isset($_FILES['arq']) && $_FILES['arq']['tmp_name'] != '') { //se um arquivo/imagem foi enviado

			@mkdir("imagens"); //cria a pasta imagens dentro de xampp\htdocs\produtos (caso não existir)

			move_uploaded_file($_FILES['arq']['tmp_name'], "imagens/" . $_GET['id'] . "_" . $_FILES['arq']['name']); //esse comando move o arquivo uppado (do endereço temporário para a pasta xampp\htdocs\produtos

			$conn -> query("update produtos set imagem='" . $_GET['id'] . "_" . $_FILES['arq']['name'] . "' where id=" . $_GET['id']); //esse comando atualiza na base de dados o endereço da imagem do produto
		}

		echo "&lt;div class=aviso>os dados do produto foram alterados&lt;/div>&lt;br>\n"; //mensagem de confirmação

	}
	else{ //se na url NÃO está definido um id então os dados do produto devem ser INSERIDOS no db

		$conn -> query("insert into produtos(nome, descricao, preco) values('".$_POST['nome']."', '".$_POST['descricao']."', '".$_POST['preco']."')"); //nessa linha o php envia um comando para inserir na base de dados

		if(isset($_FILES['arq']) && ($_FILES['arq']['tmp_name']) != '') { //se o user fez o upload da imagem do produto
			@mkdir("imagens"); //cria a pasta imagens dentro de xampp\htdocs\produtos

			$inserido = $conn -> lastInsertId(); //esse comando armazena o id do produto que foi inserido na base de dados

			move_uploaded_file($_FILES['arq']['tmp_name'], "imagens/" . $inserido . "_" . $_FILES['arq']['name']); //esse comando move o arquivo uppado (do endereço temporário para a pasta xampp\htdocs\produtos

			$conn -> query("update produtos set imagem='" . $inserido . "_".$_FILES['arq']['name']."' where id=" . $inserido); //esse comando coloca o nome da imagem uppada na base de dados
		}
		echo "&lt;div class=aviso>produto inserido na base de dados&lt;/div>&lt;br>\n";
	}
}</code></pre>
<pre><code class="language-php">
if(isset($_GET['id'])) { //se houver um id na url, então a página exibe os dados do produto para que o user possa editar

	$stmt = $conn -> query("select * from produtos where id=" . $_GET['id']); //busca no db os dados do produto

	$row = $stmt->fetch(); //armazena os dados do produto na variável $row

	if(is_file("imagens/" . $row['imagem'])) //se existe a imagem
		echo "&lt;center>&lt;img src='imagens/".$row['imagem']."' style='max-width:300px;'>&lt;/center>&lt;br>\n"; //exibe a imagem do produto

	echo "&lt;form action=index.php?id=".$_GET['id']." method=post enctype=multipart/form-data>\n";
	echo "&lt;table>\n";
	echo "&lt;tr>&lt;th colspan=2>Alterar dados do Produto&lt;/th>&lt;/tr>\n";
}
else{ //se não há id na url, então a página exibe o formulário para o user inserir dados

	$row['nome']=$row['descricao']=$row['preco']=""; //inicializa as variáveis $row que serão utilizadas no form

	echo "&lt;form action=index.php method=post enctype=multipart/form-data>\n";
	echo "&lt;table>\n";
	echo "&lt;tr>&lt;th colspan=2>Cadastro de Produto&lt;/th>&lt;/tr>\n";
}

echo "&lt;tr>&lt;td>Nome&lt;/td>&lt;td>&lt;input name=nome value='" . $row['nome'] . "'>&lt;/td>&lt;/tr>\n";
echo "&lt;tr>&lt;td>Descrição&lt;/td>&lt;td>&lt;textarea style='width:240px; height:66px;' name=descricao>" . $row['descricao'] . "&lt;/textarea>&lt;/td>&lt;/tr>\n";
echo "&lt;tr>&lt;td>Imagem&lt;/td>&lt;td>&lt;input name=arq type=file>&lt;/td>&lt;/tr>\n";
echo "&lt;tr>&lt;td>Preço&lt;/td>&lt;td>&lt;input name=preco style='width:60px;' value='" . $row['preco'] . "'>&lt;/td>&lt;/tr>\n";

echo "&lt;tr>&lt;td colspan=2 align=right>";
if(isset($_GET['id'])) //se o form está exibindo dados (para serem editados)
	echo "&lt;input type=button value=Novo onclick=\"location.href='index.php';\"> "; //um botão para ir da pag de edição para a pag de criação
echo "&lt;input type=submit value=Salvar>&lt;/td>&lt;/tr>\n";

echo "&lt;/table>\n";
echo "&lt;/form>\n";</code></pre>
</article>

	<div id="coment"><div id="disqus_thread"></div></div>
	</main>
	<footer>
		<button onclick="location.href = '../../index.htm';">home</button>
		<button onclick="exibe();">seções</button>
		<button onclick="(document.head || document.body).appendChild(s);">comente</button>
	</footer>

	<script src="../../js/script.js"></script>
	<script src="../../js/prism.js"></script>
</body>
</html>
